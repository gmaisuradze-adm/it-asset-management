@model HospitalAssetTracker.Models.InventoryItem

@{
    ViewData["Title"] = "Edit Inventory Item";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-edit"></i>
                        Edit Inventory Item: @Model.Name
                    </h3>
                    <div class="card-tools">
                        <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-info btn-sm">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                        <a asp-action="Index" class="btn btn-secondary btn-sm">
                            <i class="fas fa-list"></i> Back to List
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" method="post" class="needs-validation" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="CreatedDate" />
                        <input type="hidden" asp-for="CreatedByUserId" />

                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Basic Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="ItemCode" class="form-label required"></label>
                                            <input asp-for="ItemCode" class="form-control" readonly />
                                            <span asp-validation-for="ItemCode" class="text-danger"></span>
                                            <small class="form-text text-muted">Item code cannot be changed after creation.</small>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Name" class="form-label required"></label>
                                            <input asp-for="Name" class="form-control" required />
                                            <span asp-validation-for="Name" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Description" class="form-label"></label>
                                            <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                                            <span asp-validation-for="Description" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Category" class="form-label required"></label>
                                            <select asp-for="Category" asp-items="ViewBag.Categories" class="form-control" required>
                                                <option value="">Select Category</option>
                                            </select>
                                            <span asp-validation-for="Category" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="ItemType" class="form-label required"></label>
                                            <select asp-for="ItemType" asp-items="ViewBag.ItemTypes" class="form-control" required>
                                                <option value="">Select Item Type</option>
                                            </select>
                                            <span asp-validation-for="ItemType" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Product Details -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Product Details</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="Brand" class="form-label required"></label>
                                            <input asp-for="Brand" class="form-control" required />
                                            <span asp-validation-for="Brand" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Model" class="form-label required"></label>
                                            <input asp-for="Model" class="form-control" required />
                                            <span asp-validation-for="Model" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="SerialNumber" class="form-label"></label>
                                            <input asp-for="SerialNumber" class="form-control" />
                                            <span asp-validation-for="SerialNumber" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="PartNumber" class="form-label"></label>
                                            <input asp-for="PartNumber" class="form-control" />
                                            <span asp-validation-for="PartNumber" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="SKU" class="form-label"></label>
                                            <input asp-for="SKU" class="form-control" />
                                            <span asp-validation-for="SKU" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Status and Condition -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Status & Condition</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="Status" class="form-label required"></label>
                                            <select asp-for="Status" asp-items="ViewBag.Statuses" class="form-control" required>
                                                <option value="">Select Status</option>
                                            </select>
                                            <span asp-validation-for="Status" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Condition" class="form-label required"></label>
                                            <select asp-for="Condition" asp-items="ViewBag.Conditions" class="form-control" required>
                                                <option value="">Select Condition</option>
                                            </select>
                                            <span asp-validation-for="Condition" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Unit" class="form-label"></label>
                                            <input asp-for="Unit" class="form-control" placeholder="e.g., pieces, boxes, meters" />
                                            <span asp-validation-for="Unit" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Stock Levels -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Stock Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="Quantity" class="form-label required"></label>
                                            <input asp-for="Quantity" class="form-control" type="number" min="0" required />
                                            <span asp-validation-for="Quantity" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="ReservedQuantity" class="form-label"></label>
                                            <input asp-for="ReservedQuantity" class="form-control" type="number" min="0" />
                                            <span asp-validation-for="ReservedQuantity" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="MinimumStock" class="form-label required"></label>
                                            <input asp-for="MinimumStock" class="form-control" type="number" min="0" required />
                                            <span asp-validation-for="MinimumStock" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="MaximumStock" class="form-label required"></label>
                                            <input asp-for="MaximumStock" class="form-control" type="number" min="0" required />
                                            <span asp-validation-for="MaximumStock" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="ReorderLevel" class="form-label"></label>
                                            <input asp-for="ReorderLevel" class="form-control" type="number" min="0" />
                                            <span asp-validation-for="ReorderLevel" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Financial Information -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Financial Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="UnitCost" class="form-label"></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">$</span>
                                                </div>
                                                <input asp-for="UnitCost" class="form-control" type="number" step="0.01" min="0" />
                                            </div>
                                            <span asp-validation-for="UnitCost" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="TotalValue" class="form-label"></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">$</span>
                                                </div>
                                                <input asp-for="TotalValue" class="form-control" type="number" step="0.01" min="0" />
                                            </div>
                                            <span asp-validation-for="TotalValue" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Supplier" class="form-label"></label>
                                            <input asp-for="Supplier" class="form-control" />
                                            <span asp-validation-for="Supplier" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="SupplierPartNumber" class="form-label"></label>
                                            <input asp-for="SupplierPartNumber" class="form-control" />
                                            <span asp-validation-for="SupplierPartNumber" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Location and Storage -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Location & Storage</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="LocationId" class="form-label required"></label>
                                            <select asp-for="LocationId" asp-items="ViewBag.Locations" class="form-control" required>
                                                <option value="">Select Location</option>
                                            </select>
                                            <span asp-validation-for="LocationId" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="StorageZone" class="form-label"></label>
                                            <input asp-for="StorageZone" class="form-control" />
                                            <span asp-validation-for="StorageZone" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="StorageShelf" class="form-label"></label>
                                            <input asp-for="StorageShelf" class="form-control" />
                                            <span asp-validation-for="StorageShelf" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="StorageBin" class="form-label"></label>
                                            <input asp-for="StorageBin" class="form-control" />
                                            <span asp-validation-for="StorageBin" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="BinLocation" class="form-label"></label>
                                            <input asp-for="BinLocation" class="form-control" />
                                            <span asp-validation-for="BinLocation" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Dates and Warranty -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Dates & Warranty</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="PurchaseDate" class="form-label"></label>
                                            <input asp-for="PurchaseDate" class="form-control" type="date" />
                                            <span asp-validation-for="PurchaseDate" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="WarrantyExpiry" class="form-label"></label>
                                            <input asp-for="WarrantyExpiry" class="form-control" type="date" />
                                            <span asp-validation-for="WarrantyExpiry" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="WarrantyPeriodMonths" class="form-label"></label>
                                            <input asp-for="WarrantyPeriodMonths" class="form-control" type="number" min="0" />
                                            <span asp-validation-for="WarrantyPeriodMonths" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Options -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Additional Options</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <div class="form-check">
                                                <input asp-for="IsConsumable" class="form-check-input" type="checkbox" />
                                                <label asp-for="IsConsumable" class="form-check-label"></label>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-check">
                                                <input asp-for="RequiresCalibration" class="form-check-input" type="checkbox" />
                                                <label asp-for="RequiresCalibration" class="form-check-label"></label>
                                            </div>
                                        </div>

                                        <div class="form-group calibration-fields" style="display: none;">
                                            <label asp-for="LastCalibrationDate" class="form-label"></label>
                                            <input asp-for="LastCalibrationDate" class="form-control" type="date" />
                                            <span asp-validation-for="LastCalibrationDate" class="text-danger"></span>
                                        </div>

                                        <div class="form-group calibration-fields" style="display: none;">
                                            <label asp-for="NextCalibrationDate" class="form-label"></label>
                                            <input asp-for="NextCalibrationDate" class="form-control" type="date" />
                                            <span asp-validation-for="NextCalibrationDate" class="text-danger"></span>
                                        </div>

                                        <div class="form-group calibration-fields" style="display: none;">
                                            <label asp-for="CalibrationCertificate" class="form-label"></label>
                                            <input asp-for="CalibrationCertificate" class="form-control" />
                                            <span asp-validation-for="CalibrationCertificate" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Technical Specifications -->
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title">Technical Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label asp-for="Specifications" class="form-label"></label>
                                            <textarea asp-for="Specifications" class="form-control" rows="3" placeholder="Enter technical specifications..."></textarea>
                                            <span asp-validation-for="Specifications" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="CompatibleWith" class="form-label"></label>
                                            <textarea asp-for="CompatibleWith" class="form-control" rows="2" placeholder="List compatible items or systems..."></textarea>
                                            <span asp-validation-for="CompatibleWith" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="Notes" class="form-label"></label>
                                            <textarea asp-for="Notes" class="form-control" rows="3" placeholder="Additional notes..."></textarea>
                                            <span asp-validation-for="Notes" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer">
                            <div class="row">
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Update Item
                                    </button>
                                    <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-info">
                                        <i class="fas fa-eye"></i> View Details
                                    </a>
                                    <a asp-action="Index" class="btn btn-secondary">
                                        <i class="fas fa-list"></i> Back to List
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Toggle calibration fields based on checkbox
            function toggleCalibrationFields() {
                if ($('#RequiresCalibration').is(':checked')) {
                    $('.calibration-fields').show();
                } else {
                    $('.calibration-fields').hide();
                }
            }
            
            $('#RequiresCalibration').change(toggleCalibrationFields);
            toggleCalibrationFields(); // Initial check
            
            // Form validation
            $('.needs-validation').on('submit', function(e) {
                if (!this.checkValidity()) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                $(this).addClass('was-validated');
            });
            
            // Auto-calculate total value when unit cost or quantity changes
            $('#UnitCost, #Quantity').on('input', function() {
                var unitCost = parseFloat($('#UnitCost').val()) || 0;
                var quantity = parseInt($('#Quantity').val()) || 0;
                var totalValue = unitCost * quantity;
                $('#TotalValue').val(totalValue.toFixed(2));
            });
        });
    </script>
}

<style>
    .required::after {
        content: " *";
        color: red;
    }
    
    .card {
        margin-bottom: 1rem;
    }
    
    .form-group {
        margin-bottom: 1rem;
    }
    
    .was-validated .form-control:invalid {
        border-color: #dc3545;
    }
    
    .was-validated .form-control:valid {
        border-color: #28a745;
    }
</style>